<!-- Backdrop (tap to close) -->
<div class="mobile-backdrop" *ngIf="open" (click)="closed.emit()"></div>

<!-- Drawer -->
<nav class="mobile-menu" [class.open]="open" (click)="$event.stopPropagation()" aria-label="Menu mobile">
  <button class="close-btn" (click)="closed.emit()" aria-label="Fermer">‚úï</button>

  <!-- Liens principaux -->
  <a class="main-link" routerLink="/" (click)="closed.emit()">
    <span class="ico-emoji">üè†</span> Accueil
  </a>

  <!-- Cat√©gories -->
  <div class="accordion" *ngFor="let c of categories()">
    <div class="accordion-header">
      <!-- Tap = NAVIGATE cat√©gorie -->
      <a class="head-link"
         [routerLink]="['/categories', c._id]"
         (click)="closed.emit()">
        <span class="ico">
          <img [src]="catIcon(c)" [alt]="c.name" loading="lazy"/>
        </span>
        <span class="lbl">{{ c.name }}</span>
      </a>

      <!-- Chevron = TOGGLE sous-cat√©gories -->
      <button type="button"
              class="chev-btn"
              *ngIf="hasSubs(c._id)"
              (click)="toggleCategory(c._id); $event.stopPropagation()"
              [attr.aria-expanded]="openCatId === c._id"
              [disabled]="!hasSubs(c._id)">
        <span class="chev"  [class.rotated]="openCatId === c._id">‚Ä∫</span>
      </button>
    </div>

    <!-- Sous-cat√©gories (ic√¥nes + nav) -->
    <div class="accordion-body" *ngIf="openCatId === c._id && hasSubs(c._id)">
      <ul class="subs">
        <li *ngFor="let s of subsOf(c._id)">
          <a class="sub-link"
             [routerLink]="['/categories/sub-categories', s._id]"
             (click)="closed.emit()">
            <span class="left">
              <span class="ico sm">
                <img [src]="subIcon(s)" [alt]="s.name" loading="lazy"/>
              </span>
              <span class="lbl">{{ s.name }}</span>
            </span>
          </a>
        </li>
        <li *ngIf="subsOf(c._id).length===0" class="muted" style="padding:6px 12px;">Aucune sous-cat√©gorie.</li>
      </ul>
    </div>
  </div>

  <a class="main-link" routerLink="/contact" (click)="closed.emit()">
    <span class="ico-emoji">üìû</span> Contact
  </a>
</nav>
