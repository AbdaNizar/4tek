<!-- src/app/layout/header/header-search/header-search.component.html -->
<div class="search-wrap" [class.open]="isOpen && isMobile">
  <!-- Desktop -->
  <form class="searchbar desktop"
        *ngIf="!isMobile"
        (submit)="onSubmit($event)"
        role="search">
    <input
      type="search"
      name="q"
      [placeholder]="'Rechercher des produits…'"
      [ngModel]="query"
      (ngModelChange)="onType($event)"
      aria-label="Rechercher" />
    <button type="submit" aria-label="Rechercher">
      <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
        <path fill="currentColor"
              d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 1 0-1.41 1.41l.27.28v.79L20 21.5 21.5 20 15.5 14zm-6 0A4.5 4.5 0 1 1 14 9.5 4.5 4.5 0 0 1 9.5 14z"/>
      </svg>
    </button>

    <!-- Suggestions (desktop) -->
    <div class="suggest" *ngIf="query && (results().length || loading() || error())">
      <div class="loading" *ngIf="loading()">Recherche…</div>
      <div class="error" *ngIf="!loading() && error()">{{ error() }}</div>

      <ng-container *ngIf="!loading() && !error() && results().length">
        <a class="hit" *ngFor="let p of results(); trackBy: trackById"
           [routerLink]="['/produits', p._id]">
          <img class="thumb" [src]="getUrl(p.imageUrl) || 'assets/images/placeholder.jpg'" [alt]="p.name">
          <div class="meta">
            <div class="name">{{ p.name }}</div>
            <div class="crumbs" *ngIf="p.category?.name">
              {{ p.category?.name }} <ng-container *ngIf="p.subCategory?.name">› {{ p.subCategory?.name }}</ng-container>
            </div>
          </div>
        </a>
      </ng-container>

      <div class="empty" *ngIf="!loading() && !error() && !results().length">
        Aucun résultat.
      </div>
    </div>
  </form>

  <!-- Mobile bouton -->
  <button
    *ngIf="!isOpen"
    class="icon-btn search-icon-mobile"
    type="button"
    aria-label="Ouvrir la recherche"
    (click)="openMobile()">
    <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true">
      <path fill="currentColor"
            d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 1 0-1.41 1.41l.27.28v.79L20 21.5 21.5 20 15.5 14zm-6 0A4.5 4.5 0 1 1 14 9.5 4.5 4.5 0 0 1 9.5 14z"/>
    </svg>
  </button>

  <!-- Mobile overlay -->
  <div *ngIf=" isOpen" class="backdrop" (click)="closeMobile()"></div>

  <div *ngIf="isOpen" class="mobile-sheet" role="dialog" aria-modal="true">
    <form class="searchbar mobile" (submit)="onSubmit($event)" role="search">
      <button class="icon-btn" type="button" aria-label="Fermer" (click)="closeMobile()">×</button>
      <input
        #mobileInput
        type="search"
        name="q"
        [placeholder]="'Rechercher des produits…'"
        [ngModel]="query"
        (ngModelChange)="onType($event)"
        aria-label="Rechercher dans le site" />
      <button type="submit" aria-label="Rechercher">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor" d="M15.5 14h-.79l-.28-.27a6.5 6.5 0 1 0-1.41 1.41l.27.28v.79L20 21.5 21.5 20 15.5 14zm-6 0A4.5 4.5 0 1 1 14 9.5 4.5 4.5 0 0 1 9.5 14z"/>
        </svg>
      </button>
    </form>

    <!-- Suggestions (mobile) -->
    <div class="suggest mobile" *ngIf="query && (results().length || loading() || error())">
      <div class="loading" *ngIf="loading()">Recherche…</div>
      <div class="error" *ngIf="!loading() && error()">{{ error() }}</div>

      <a class="hit" *ngFor="let p of results(); trackBy: trackById"
         [routerLink]="['/produits', p._id]"
         (click)="closeMobile()">
        <img class="thumb" [src]="getUrl(p.imageUrl) || 'assets/images/placeholder.jpg'" [alt]="p.name">
        <div class="meta">
          <div class="name">{{ p.name }}</div>
          <div class="crumbs" *ngIf="p.category?.name">
            {{ p.category?.name }} <ng-container *ngIf="p.subCategory?.name">› {{ p.subCategory?.name }}</ng-container>
          </div>
        </div>
      </a>

      <div class="empty" *ngIf="!loading() && !error() && !results().length">
        Aucun résultat.
      </div>
    </div>
  </div>
</div>
