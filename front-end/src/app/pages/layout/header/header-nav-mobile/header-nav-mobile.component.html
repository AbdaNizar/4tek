<!-- Backdrop (tap to close) -->
<div class="mobile-backdrop" *ngIf="open" (click)="closed.emit()"></div>

<!-- Drawer -->
<nav class="mobile-menu" [class.open]="open" (click)="$event.stopPropagation()" aria-label="Menu mobile">

  <!-- Close button -->
  <button class="close-btn" (click)="closed.emit()" aria-label="Fermer">
    ‚úï
  </button>

  <!-- Main links -->
  <a class="main-link" routerLink="/" (click)="closed.emit()">
    <span class="ico">üè†</span> Accueil
  </a>

  <!-- Category Accordion -->
  <div class="accordion" *ngFor="let c of categories()">
    <button class="accordion-header"
            (click)="toggleCategory(c._id)">
      <div class="ico">
        <img [src]="getUrl(c.iconUrl || c.imageUrl || c.banners?.[0]) || '/assets/placeholder.jpg'" [alt]="c.name" />
      </div>
      <span>{{ c.name }}</span>
      <span class="chev" [class.rotated]="openCatId === c._id">‚Ä∫</span>
    </button>

    <!-- Subcategories -->
    <!-- Subcategories -->
    <div class="accordion-body" *ngIf="openCatId === c._id">
      <ul>
        <li *ngFor="let s of subsCache.get(c._id) || []">
          <button class="sub-link" (click)="toggleSub(s._id)">
            {{ s.name }}
            <span class="chev small" [class.rotated]="openSubId === s._id">‚Ä∫</span>
          </button>

          <!-- Produits de la sous-cat√©gorie (afficher seulement s'il y en a) -->
          <ul class="sub-products" *ngIf="openSubId === s._id && (prodsCache.get(s._id)?.length || 0) > 0">
            <li *ngFor="let p of prodsCache.get(s._id) || []">
              <a [routerLink]="['/produits', p._id]" (click)="closed.emit()">
                {{ p.name }}
              </a>
            </li>
            <li class="all">
              <a [routerLink]="['/categories', c._id, 'sub', s._id]" (click)="closed.emit()">
                Tous les articles ‚Üí
              </a>
            </li>
          </ul>
        </li>

        <!-- Si aucune sous-cat√©gorie -->
        <li *ngIf="(subsCache.get(c._id)?.length || 0) === 0" class="muted" style="padding:6px 12px;">
          Aucune sous-cat√©gorie.
        </li>
      </ul>
    </div>

  </div>

  <a class="main-link" routerLink="/contact" (click)="closed.emit()">
    <span class="ico">üìû</span> Contact
  </a>
</nav>
