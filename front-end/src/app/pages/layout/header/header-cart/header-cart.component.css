/* === Bouton Panier ======================================================= */
.cart-btn {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, .12);
  background: rgba(255, 255, 255, .05);
  color: var(--text);
  transition: border-color .2s, transform .08s;
}

.cart-btn:hover { border-color: rgba(255, 255, 255, .35); }
.cart-btn:active { transform: translateY(1px); }
.cart-btn:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }

.cart-badge {
  position: absolute;
  top: -6px;
  right: -6px;
  min-width: 18px;
  height: 18px;
  padding: 0 4px;
  display: inline-grid;
  place-items: center;
  font: 700 11px/18px system-ui;
  color: #fff;
  background: #ef4444;
  border-radius: 999px;
}

/* === Backdrop ============================================================ */
.cart-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, .45);
  backdrop-filter: blur(2px);
  z-index: 10000;
  animation: cartFade .18s ease both;
  border-radius: 30px;
}
@keyframes cartFade { from { opacity: 0 } to { opacity: 1 } }

/* === Dropdown / Drawer (conteneur) ====================================== */
.cart-dropdown {
  position: fixed;
  right: 12px;
  top: 70px; /* sous le header */
  z-index: 10001;
  animation: cartSlideDown .18s ease both;
}
@keyframes cartSlideDown {
  from { opacity: .0; transform: translateY(-6px) }
  to   { opacity: 1;  transform: none }
}

/* === Cart Box : grille + style ========================================== */
.cart-box {
  width: 360px;
  /* grille pour fixer les zones et scroller uniquement la liste */
  display: grid;
  grid-template-rows:
    auto   /* .cart-top */
    auto   /* .btn-checkout */
    1fr    /* .cart-list (scrolle) */
    auto;  /* .cart-link */
  gap: 8px;

  max-height: none;     /* scroll géré par la liste */
  overflow: visible;    /* pas de scroll sur le conteneur */

  background: rgba(18, 24, 38, .96);
  backdrop-filter: blur(16px);
  border: 1px solid rgba(255, 255, 255, .08);
  border-radius: 16px;
  box-shadow: 0 24px 60px rgba(0, 0, 0, .45);
  padding: 15px;

  position: relative;   /* pour le bouton close */
  padding-top: 38px;    /* espace pour le bouton close */
}

/* === Bouton de fermeture ================================================= */
.cart-x {
  position: absolute;
  right: 6px;
  width: 40px;
  height: 40px;
  background: none;
  border: none;
  color: #9aa3b2;
  font-size: 22px;
  cursor: pointer;
  border-radius: 10px;
  padding: 4px 8px;
  transition: color .15s, background .15s;
}
.cart-x:hover { color: var(--accent); background: rgba(255, 255, 255, .06); }
.cart-x:active { transform: translateY(1px); }
.cart-x:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }

/* === Bandeau haut / résumé ============================================== */
.cart-top {
  position: sticky;
  top: 0;
  z-index: 1;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  margin: 4px 2px 8px;
  padding-bottom: 8px;
  background: inherit; /* garde le fond blurry sous le sticky */
}

/* === CTA “Passer à la caisse” =========================================== */
.btn-checkout {
  width: 100%;
  height: 40px;
  margin: 6px 0 10px;
  border-radius: 12px;
  border: none;
  background: var(--primary);
  color: #fff;
  font-weight: 800;
  cursor: pointer;
  transition: filter .15s;
}
.btn-checkout:hover { filter: brightness(1.06); }

/* === La LISTE est le seul bloc scrollable =============================== */
.cart-list {
  overflow: auto;
  min-height: 0;                       /* indispensable quand on utilise 1fr */
  max-height: min(70vh, 520px);        /* borne desktop */
  padding-right: 2px;                  /* décale la scrollbar */
}
/* Scrollbar discrète */
.cart-list::-webkit-scrollbar { width: 8px; height: 8px; }
.cart-list::-webkit-scrollbar-track { background: rgba(255,255,255,.05); border-radius: 8px; }
.cart-list::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,.18);
  border-radius: 8px;
  border: 2px solid transparent;
  background-clip: padding-box;
}
.cart-list:hover::-webkit-scrollbar-thumb { background: rgba(255,255,255,.28); }

/* === Séparateur ========================================================== */
.line hr { border: 0; border-top: 1px solid rgba(255, 255, 255, .08); }

/* === Ligne produit ======================================================= */
.cart-row {
  display: grid;
  grid-template-columns: 64px 1fr;
  gap: 10px;
  padding: 10px 0;
  align-items: start;
}

.thumb {
  width: 64px;
  height: 64px;
  border-radius: 10px;
  object-fit: cover;
  background: #0e1525;
  border: 1px solid rgba(255, 255, 255, .06);
}

.meta { display: grid; gap: 6px; }
.title { margin: 0; font-weight: 800; }
.price { font-weight: 700; }

/* === Contrôles qté + actions ============================================ */
.controls {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  flex-wrap: wrap;
}

.qty {
  display: inline-flex;
  align-items: center;
  border: 1px solid rgba(255, 255, 255, .12);
  border-radius: 10px;
  overflow: hidden;
}

.qty input {
  width: 48px;
  height: 28px;
  background: transparent;
  border: none;
  color: var(--text);
  text-align: center;
  outline: none;
}

.qty button {
  width: 28px;
  height: 28px;
  border: none;
  background: transparent;
  color: var(--text);
  cursor: pointer;
}

.icon {
  width: 32px;
  height: 32px;
  display: grid;
  place-items: center;
  background: transparent;
  color: #9aa3b2;
  border: 1px solid rgba(255, 255, 255, .12);
  border-radius: 10px;
  transition: border-color .15s, color .15s, background .15s;
}
.icon:hover { color: #fff; border-color: rgba(255, 255, 255, .25); background: rgba(255, 255, 255, .05); }

/* === États vides + lien “voir panier” =================================== */
.muted.empty { text-align: center; padding: 12px 0; color: #9aa3b2; }
.cart-link { display: block; margin-top: 8px; text-align: center; color: var(--accent); text-decoration: none; }

/* === Mobile: Drawer depuis la droite ==================================== */
@media (max-width: 520px) {
  .cart-dropdown {
    top: 0; right: 0; left: auto; bottom: 0;
    width: 88vw; max-width: 420px; height: 100dvh;
    animation: cartSlideIn .22s cubic-bezier(.4, 0, .2, 1) both;
  }
  @keyframes cartSlideIn {
    from { transform: translateX(12px); opacity: .0 }
    to   { transform: none;            opacity: 1 }
  }

  .cart-box {
    width: 100%;
    max-height: none;
    border-radius: 14px 0 0 14px;
    padding: 14px;
    grid-template-rows: auto auto 1fr auto; /* déjà défini mais on précise pour mobile */
    gap: 8px;
    padding-top: 46px; /* plus de marge pour le bouton close */
  }

  .cart-x {
    top: 8px;
    right: 8px;
    width: 36px;
    height: 36px;
    font-size: 20px;
  }

  .cart-top { margin: 2px 2px 6px; padding-bottom: 6px; }

  .cart-list { overflow: auto; min-height: 0; max-height: none; }

  .btn-checkout {
    position: sticky;
    bottom: 0;
    box-shadow: 0 -8px 20px rgba(0, 0, 0, .35);
    height: 46px;
    border-radius: 12px;
  }

  .qty button { width: 32px; height: 32px; }
  .qty input  { height: 32px; width: 56px; }
}
/* ===== Fix scroll mobile (iOS/Android) ===== */
@media (max-width: 520px) {
  /* Le conteneur occupe tout l'écran pour contraindre la hauteur */
  .cart-dropdown {
    top: 0;
    right: 0;
    left: auto;
    bottom: 0;
    width: 88vw;
    max-width: 420px;
    height: 100dvh;
    display: flex;              /* NEW: force un contexte de hauteur */
    align-items: stretch;       /* NEW */
    animation: cartSlideIn .22s cubic-bezier(.4, 0, .2, 1) both;
  }

  /* La box prend 100% de la hauteur dispo */
  .cart-box {
    width: 100%;
    height: 100%;               /* NEW: contrainte verticale */
    max-height: none;
    border-radius: 14px 0 0 14px;
    padding: 14px;
    padding-top: 46px;
    display: grid;
    grid-template-rows: auto auto 1fr auto; /* header / btn / list / link */
    gap: 8px;
  }

  /* La liste devient la SEULE zone scrollable */
  .cart-list {
    overflow: auto !important;      /* NEW */
    min-height: 0;                  /* NEW: indispensable avec 1fr */
    -webkit-overflow-scrolling: touch; /* NEW: inertie iOS */
  }

  /* Barre de scroll plus visible sur mobile (WebKit) */
  .cart-list::-webkit-scrollbar {
    width: 10px;                    /* NEW: plus épais */
  }
  .cart-list::-webkit-scrollbar-track {
    background: rgba(255,255,255,.07);
    border-radius: 10px;
  }
  .cart-list::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,.35);
    border-radius: 10px;
    border: 2px solid transparent;
    background-clip: padding-box;
  }

  /* Firefox (couleur de scrollbar) */
  .cart-list {
    scrollbar-width: thin;          /* NEW */
    scrollbar-color: rgba(255,255,255,.35) rgba(255,255,255,.07);
  }
}
